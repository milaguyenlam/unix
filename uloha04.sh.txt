#!/bin/sh

sed -E "
: label
/.*[0-9]+ *\+ *[0-9]+.*/{
h
s/(.*)/a\1a/
s/.*[^0-9]([0-9]+) *\+ *([0-9]+)[^0-9].*/\1 \2/
s/(.*)/,\1/
: l1
s/([0-9]*),([0-9]*)([0-9]) ([0-9]*)([0-9])/\1\3\5,\2 \4/
t l1
s/ //g
: l4
s/([0-9]+),([0-9]*)([0-9])/\10\3,\2/
t l4
s/([0-9]+),/\1/
t F
: F
s/([0-9]{2})([0-9]+)/,0\1:\2/
t l2
s/([0-9]{2})/,0\1:/
: l2
: l5
/[0-9]*,[0-9]+:[0-9]*/{
: l6
/[0-9]*,X*[0-9]+X*:[0-9]*/{
s/,(.*)0(.*):/,\1\2:/
s/,(.*)1(.*):/,\1X\2:/
s/,(.*)2(.*):/,\1XX\2:/
s/,(.*)3(.*):/,\1XXX\2:/
s/,(.*)4(.*):/,\1XXXX\2:/
s/,(.*)5(.*):/,\1XXXXX\2:/
s/,(.*)6(.*):/,\1XXXXXX\2:/
s/,(.*)7(.*):/,\1XXXXXXX\2:/
s/,(.*)8(.*):/,\1XXXXXXXX\2:/
s/,(.*)9(.*):/,\1XXXXXXXXX\2:/
b l6
}
t blbost
: blbost
s/,(X*)XXXXXXXXXX:/,\11:/
t l8
s/,(X*):/,\10:/
: l8
s/,([0-9]):/,0\1:/
s/,X{1}([0-9]):/,1\1:/
s/,X{2}([0-9]):/,2\1:/
s/,X{3}([0-9]):/,3\1:/
s/,X{4}([0-9]):/,4\1:/
s/,X{5}([0-9]):/,5\1:/
s/,X{6}([0-9]):/,6\1:/
s/,X{7}([0-9]):/,7\1:/
s/,X{8}([0-9]):/,8\1:/
s/,X{9}([0-9]):/,9\1:/
t c
: c
s/([0-9]*),([0-9])([0-9]*):([0-9]{2})([0-9]*)/\2\1,\3\4:\5/
t lc
s/([0-9]*),([0-9])([0-9]*):/\3\2\1/
: lc
b l5
}
s/^0([0-9]+)/\1/
s/(.*)/\1,a/
G
s/([0-9]*),(.*[^0-9])[0-9]+ *\+ *[0-9]+(.*)/\2\1\3/
s/^a//
b label
}
"
